<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Dataframe validation • interfacer</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Dataframe validation">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">interfacer</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/interfacer.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/consistency.html">Parameter consistency checking with interfacer</a></li>
    <li><a class="dropdown-item" href="../articles/devtools.html">Tools to work with `interfacer`</a></li>
    <li><a class="dropdown-item" href="../articles/dispatch.html">Multiple dispatch based on dataframes</a></li>
    <li><a class="dropdown-item" href="../articles/nesting.html">Nested dataframes and `purrr` style list columns</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/bristol-vaccine-centre/interfacer/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Dataframe validation</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/bristol-vaccine-centre/interfacer/blob/HEAD/vignettes/interfacer.Rmd" class="external-link"><code>vignettes/interfacer.Rmd</code></a></small>
      <div class="d-none name"><code>interfacer.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bristol-vaccine-centre.github.io/interfacer/">interfacer</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="rationale">Rationale<a class="anchor" aria-label="anchor" href="#rationale"></a>
</h2>
<p><code>interfacer</code> is designed to support package authors who
wish to use dataframes as input parameters to package functions. In this
case assumptions about the structure of the input dataframe, in terms of
expected column names, expected column data types, and expected grouping
structure is a common problem that leads to a lot of code to validate
input and detect edge cases in grouping, and creates the requirement for
detailed documentation about the nature of accepted input
dataframes.</p>
<p><code>interfacer</code> provides a mechanism for simply specifying
input dataframe constraints as an <code>iface</code> specification, a
one liner for validating input, and an <code>roxygen2</code> tag for
automating documentation of dataframe inputs. This is not dissimilar
conceptually to the definition of a table in a relational database, or
the specification of an XML schema.</p>
<p><code>interfacer</code> also provides capabilities that support
checking dataframe function outputs, dispatching to functions based on
dataframe input structure, and flexibly handling unexpectedly grouped
data.</p>
</div>
<div class="section level2">
<h2 id="defining-an-interface">Defining an interface<a class="anchor" aria-label="anchor" href="#defining-an-interface"></a>
</h2>
<p>An <code>iface</code> specification defines the structure of
acceptable dataframes. It is a list of column names, plus types and some
documentation about the column.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">i_test</span> <span class="op">=</span> <span class="fu"><a href="../reference/iface.html">iface</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="va">integer</span> <span class="op">~</span> <span class="st">"an integer ID"</span>,</span>
<span>  test <span class="op">=</span> <span class="va">logical</span> <span class="op">~</span> <span class="st">"the test result"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Printing an interface specification shows the structure that the
<code>iface</code> defines.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">i_test</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; A dataframe containing the following columns: </span></span>
<span><span class="co">#&gt; * id (integer) - an integer ID</span></span>
<span><span class="co">#&gt; * test (logical) - the test result</span></span>
<span><span class="co">#&gt; Any grouping allowed.</span></span></code></pre></div>
<p>An <code>iface</code> specification is associated with a specific
function parameter by being set as the default value for that parameter.
This is a dummy default value but when combined with
<code>ivalidate</code> in the function body a user supplied dataframe is
validated to ensure it is of the right shape. We can use
<code>@iparam &lt;param&gt; &lt;description&gt;</code> in the
<code>roxygen2</code> documentation to describe the dataframe
constraints.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' An example function</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @iparam mydata a dataframe input which should conform to `i_test`</span></span>
<span><span class="co">#' @param another an example</span></span>
<span><span class="co">#' @param ... not used</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @return the conformant dataframe</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">example_fn</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span></span>
<span>  <span class="va">mydata</span> <span class="op">=</span> <span class="va">i_test</span>,</span>
<span>  <span class="va">another</span> <span class="op">=</span> <span class="st">"value"</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">mydata</span> <span class="op">=</span> <span class="fu"><a href="../reference/ivalidate.html">ivalidate</a></span><span class="op">(</span><span class="va">mydata</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">mydata</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>In this case when we later call <code>example_fn</code> the data is
checked against the requirements by <code>ivalidate</code>, and if
acceptable passed on to the rest of the function body (in this case it
does nothing and the validated input is returned).</p>
<p>If we call this function with data that conforms the validation
succeeds and the validated input data is returned.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">example_data</span> <span class="op">=</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>    id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span>, <span class="co"># this is a numeric vector</span></span>
<span>    test <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>,<span class="cn">FALSE</span>,<span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># this returns the qualifying data</span></span>
<span><span class="fu">example_fn</span><span class="op">(</span></span>
<span>  <span class="va">example_data</span>, </span>
<span>  <span class="st">"value for another"</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 3</span></span>
<span><span class="co">#&gt; Columns: 2</span></span>
<span><span class="co">#&gt; $ id   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 2, 3</span></span>
<span><span class="co">#&gt; $ test <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> TRUE, FALSE, TRUE</span></span></code></pre></div>
<p>It should be noted that although we passed a numeric vector in the
<code>id</code> column to the function it has been coerced into an
<code>int</code> vector by <code>ivalidate</code>. Data type checking in
<code>interfacer</code> is permissive in that if something can be
coerced without warning it will be.</p>
<p>If we pass non-conformant data <code>ivalidate</code> throws an
informative error about what is wrong with the data. In this case the
<code>test</code> column is missing:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bad_example_data</span> <span class="op">=</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>    id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span>,</span>
<span>    wrong_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>,<span class="cn">FALSE</span>,<span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># this causes an error as example_data_2$wrong_test is wrongly named</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">example_fn</span><span class="op">(</span></span>
<span>  <span class="va">bad_example_data</span>, </span>
<span>  <span class="st">"value for another"</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error : missing columns in the `mydata` parameter of `example_fn(...)`.</span></span>
<span><span class="co">#&gt; missing: test</span></span>
<span><span class="co">#&gt; consider renaming / creating missing columns before calling `example_fn(...)`</span></span></code></pre></div>
<p>We can recover from this error by renaming the columns before passing
<code>bad_example_data</code> to <code>example_fn()</code>.</p>
<p>In a second example the input data frame is non-conformant to the
specification as the id column cannot be coerced to an integer.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bad_example_data_2</span> <span class="op">=</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>    id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2.1</span>, <span class="fl">3</span><span class="op">)</span>, <span class="co"># cannot be cleanly coerced to integer.</span></span>
<span>    test <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>,<span class="cn">FALSE</span>,<span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">example_fn</span><span class="op">(</span></span>
<span>  <span class="va">bad_example_data_2</span>, </span>
<span>  <span class="st">"value for another"</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error : input column `id` in function parameter `example_fn(mydata = ?)` cannot be coerced to a integer: rounding detected</span></span></code></pre></div>
<p>This error aims to be informative enough for the user to fix the
problem.</p>
</div>
<div class="section level2">
<h2 id="extension-and-composition">Extension and composition<a class="anchor" aria-label="anchor" href="#extension-and-composition"></a>
</h2>
<p>Interface specifications can be composed and extended. In this case
an extension of the <code>i_test</code> specification can be
created:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">i_test_extn</span> <span class="op">=</span> <span class="fu"><a href="../reference/iface.html">iface</a></span><span class="op">(</span></span>
<span>  <span class="va">i_test</span>,</span>
<span>  extra <span class="op">=</span> <span class="va">character</span> <span class="op">~</span> <span class="st">"a new value"</span>,</span>
<span>  .groups <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">i_test_extn</span><span class="op">)</span></span>
<span><span class="co">#&gt; A dataframe containing the following columns: </span></span>
<span><span class="co">#&gt; * id (integer) - an integer ID</span></span>
<span><span class="co">#&gt; * test (logical) - the test result</span></span>
<span><span class="co">#&gt; * extra (character) - a new value</span></span>
<span><span class="co">#&gt; Ungrouped.</span></span></code></pre></div>
<p>This extended <code>iface</code> specification adds in the constraint
for a character column named <code>extra</code> and that there must not
be any grouping. This is used to constrain the input of another example
function as before. We also constrain the output of this second function
to be conformant to the original specification using
<code>ireturn</code>. Examples of documenting the input parameter and
the output parameter are provided here:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#' Another example function </span></span>
<span><span class="co">#' </span></span>
<span><span class="co">#' @iparam mydata a more constrained input</span></span>
<span><span class="co">#' @param another an example   </span></span>
<span><span class="co">#' @param ... not used</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @return `r i_test`</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">example_fn2</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span></span>
<span>    <span class="va">mydata</span> <span class="op">=</span> <span class="va">i_test_extn</span>,</span>
<span>    <span class="va">...</span></span>
<span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">mydata</span> <span class="op">=</span> <span class="fu"><a href="../reference/ivalidate.html">ivalidate</a></span><span class="op">(</span><span class="va">mydata</span>, <span class="va">...</span>, .prune <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="va">mydata</span> <span class="op">=</span> <span class="va">mydata</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">extra</span><span class="op">)</span></span>
<span>  <span class="co"># check the return value conforms to a new specification</span></span>
<span>  <span class="fu"><a href="../reference/ireturn.html">ireturn</a></span><span class="op">(</span><span class="va">mydata</span>, <span class="va">i_test</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>In this case the <code>ivalidate</code> call prunes unneeded data
from the dataframe, removing any extra columns, and also ensures that
the input is not grouped in any way. (Grouping is described in more
detail below.)</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">grouped_example_data</span> <span class="op">=</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>    id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span>,</span>
<span>    test <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>,<span class="cn">FALSE</span>,<span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    extra <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>,<span class="st">"b"</span>,<span class="st">"c"</span><span class="op">)</span>,</span>
<span>    unneeded <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="st">"y"</span>,<span class="st">"z"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span></span></code></pre></div>
<p>This is rejected because the grouping is incorrect. An informative
error message is provided:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">example_fn2</span><span class="op">(</span><span class="va">grouped_example_data</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error : unexpected additional groups in `mydata` parameter of `example_fn2(...)`</span></span>
<span><span class="co">#&gt; additional: id</span></span>
<span><span class="co">#&gt; consider regrouping your data before calling function `example_fn2(...)`, e.g.:</span></span>
<span><span class="co">#&gt; `df %&gt;% ungroup() %&gt;% example_fn2(...)`</span></span>
<span><span class="co">#&gt; or calling function `example_fn2(...)` using a group_modify, e.g.:</span></span>
<span><span class="co">#&gt; `df %&gt;% group_by(id) %&gt;% group_modify(example_fn2, ...)`</span></span></code></pre></div>
<p>Following the instructions in the error message makes this previously
failing data validate against <code>i_test_extn</code>:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">grouped_example_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">example_fn2</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 3</span></span>
<span><span class="co">#&gt; Columns: 2</span></span>
<span><span class="co">#&gt; $ id   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 2, 3</span></span>
<span><span class="co">#&gt; $ test <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> TRUE, FALSE, TRUE</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="grouping">Grouping<a class="anchor" aria-label="anchor" href="#grouping"></a>
</h2>
<p>Unanticipated grouping is a common cause of unexpected behaviour in
functions that operate on dataframes. <code>interfacer</code> can also
specify what degree of grouping is expected. This can take the form of
constraints that a) enforce that no grouping is present, or b) enforce
that the dataframe is grouped by exactly a given set of columns, or c)
enforce that a data frame is grouped by at least a given set of columns
(with possibly more).</p>
<p>An <code>iface</code> specification can permissive or dogmatic about
the grouping of the input. If the .groups option in an
<code>iface</code> specification is NULL (e.g.
<code>iface(..., .groups=NULL)</code>) then any grouping is allowed. If
it is <code>FALSE</code> then no grouping is allowed. The third option
is to supply a one sided formula. In this case the variables in the
formula define the grouping that must be exactly present,
e.g. <code>~ grp1 + grp2</code>, but if it also includes a
<code>.</code>, then additional grouping is also permitted
(e.g. <code>~ . + grp1 + grp2</code>). This permissive form would allow
a grouping such as
<code>df %&gt;% group_by(anything, grp1, grp2)</code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">i_diamonds</span> <span class="op">=</span> <span class="fu">interfacer</span><span class="fu">::</span><span class="fu"><a href="../reference/iface.html">iface</a></span><span class="op">(</span></span>
<span>    carat <span class="op">=</span> <span class="va">numeric</span> <span class="op">~</span> <span class="st">"the carat column"</span>,</span>
<span>    color <span class="op">=</span> <span class="fu">enum</span><span class="op">(</span><span class="va">`D`</span>,<span class="va">`E`</span>,<span class="va">`F`</span>,<span class="va">`G`</span>,<span class="va">`H`</span>,<span class="va">`I`</span>,<span class="va">`J`</span>, .ordered<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">~</span> <span class="st">"the color column"</span>,</span>
<span>    x <span class="op">=</span> <span class="va">numeric</span> <span class="op">~</span> <span class="st">"the x column"</span>,</span>
<span>    y <span class="op">=</span> <span class="va">numeric</span> <span class="op">~</span> <span class="st">"the y column"</span>,</span>
<span>    z <span class="op">=</span> <span class="va">numeric</span> <span class="op">~</span> <span class="st">"the z column"</span>,</span>
<span>    <span class="co"># This specifies a permissive grouping with at least `carat` and `cut` columns</span></span>
<span>    .groups <span class="op">=</span> <span class="op">~</span> <span class="va">.</span> <span class="op">+</span> <span class="va">carat</span> <span class="op">+</span> <span class="va">cut</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/is_installed.html" class="external-link">is_installed</a></span><span class="op">(</span><span class="st">"ggplot2"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># permissive grouping with the `~ . + carat + cut` groups rule</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="va"><a href="https://ggplot2.tidyverse.org/reference/diamonds.html" class="external-link">diamonds</a></span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">color</span>, <span class="va">carat</span>, <span class="va">cut</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="co"># in a usual workflow this would be an `ivalidate` call within a package </span></span>
<span>    <span class="co"># function but for this example we are directly calling the underlying function</span></span>
<span>    <span class="co"># `iconvert`</span></span>
<span>    <span class="fu"><a href="../reference/iconvert.html">iconvert</a></span><span class="op">(</span><span class="va">i_diamonds</span>, .prune <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; Rows: 53,940</span></span>
<span><span class="co">#&gt; Columns: 6</span></span>
<span><span class="co">#&gt; Groups: color, carat, cut [4,803]</span></span>
<span><span class="co">#&gt; $ color <span style="color: #949494; font-style: italic;">&lt;ord&gt;</span> E, E, E, I, J, J, I, H, E, H, J, J, F, J, E, E, I, J, J, J, I, E…</span></span>
<span><span class="co">#&gt; $ carat <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.23, 0.21, 0.23, 0.29, 0.31, 0.24, 0.24, 0.26, 0.22, 0.23, 0.30…</span></span>
<span><span class="co">#&gt; $ cut   <span style="color: #949494; font-style: italic;">&lt;ord&gt;</span> Ideal, Premium, Good, Premium, Good, Very Good, Very Good, Very …</span></span>
<span><span class="co">#&gt; $ x     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 3.95, 3.89, 4.05, 4.20, 4.34, 3.94, 3.95, 4.07, 3.87, 4.00, 4.25…</span></span>
<span><span class="co">#&gt; $ y     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 3.98, 3.84, 4.07, 4.23, 4.35, 3.96, 3.98, 4.11, 3.78, 4.05, 4.28…</span></span>
<span><span class="co">#&gt; $ z     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 2.43, 2.31, 2.31, 2.63, 2.75, 2.48, 2.47, 2.53, 2.49, 2.39, 2.73…</span></span></code></pre></div>
<p>If a group column is specified it must be present, regardless of the
rest of the <code>iface</code> specification. So in this example the
<code>cut</code> column is required by the <code>i_diamonds</code>
contract but its data type is not specified.</p>
<p>Rather than create a third example function we have in this example
used <code>iconvert</code> which is an interactive for of
<code>ivalidate</code>.</p>
</div>
<div class="section level2">
<h2 id="documentation">Documentation<a class="anchor" aria-label="anchor" href="#documentation"></a>
</h2>
<p>The <code>roxygen2</code> block of documentation for this second
interface is determined by the <code>#' @iparam</code> block, which uses
the underlying function <code>idocument</code>. Demonstrating the
behaviour of the <code>@iparam</code> <code>roxygen2</code> tag is hard
in a vignette but essentially it inserts the following block into the
documentation when <code><a href="https://devtools.r-lib.org/reference/document.html" class="external-link">devtools::document</a></code> is called:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="../reference/idocument.html">idocument</a></span><span class="op">(</span><span class="va">example_fn2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; A dataframe containing the following columns: </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; * id (integer) - an integer ID</span></span>
<span><span class="co">#&gt; * test (logical) - the test result</span></span>
<span><span class="co">#&gt; * extra (character) - a new value</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Ungrouped.</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="type-coercion">Type coercion<a class="anchor" aria-label="anchor" href="#type-coercion"></a>
</h2>
<p><code>interfacer</code> does not implement a rigid type system, but
rather a permissive one. If the provided data can be coerced to the
specified type without major loss then this is automatically done, as
long as it can proceed with no warnings. In this example <code>id</code>
(expected to be an integer) is provided as a <code>character</code> and
<code>extra</code> (expected to be a character) is coerced from the
provided numeric.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1"</span>,<span class="st">"2"</span>,<span class="st">"3"</span><span class="op">)</span>,</span>
<span>  test <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>,<span class="cn">FALSE</span>,<span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  extra <span class="op">=</span> <span class="fl">1.1</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span><span class="fu">example_fn2</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 3</span></span>
<span><span class="co">#&gt; Columns: 2</span></span>
<span><span class="co">#&gt; $ id   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 2, 3</span></span>
<span><span class="co">#&gt; $ test <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> TRUE, FALSE, TRUE</span></span></code></pre></div>
<p>Completely incorrect data types on the other hand are picked up and
rejected. In this case the data supplied for <code>id</code> cannot be
cast to integer without loss. Similar behaviour is seen if logical data
is anything other than 0 or 1 for example.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">example_fn</span><span class="op">(</span></span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>    id<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1.1"</span>,<span class="st">"2"</span>,<span class="st">"3"</span><span class="op">)</span>,</span>
<span>    test <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>,<span class="cn">FALSE</span>,<span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error : input column `id` in function parameter `example_fn(mydata = ?)` cannot be coerced to a integer: rounding detected</span></span></code></pre></div>
<p>Factors might have allowable levels as well. For this we define them
as an <code>enum</code> which accepts a list of values, which then must
be matched by the levels of a provided factor. The order of the levels
will be taken from the <code>iface</code> specification and re-levelling
of inputs is taken to ensure the factor levels match the specification.
If <code>.drop = TRUE</code> is specified then values which don’t match
the levels will be cast to <code>NA</code> rather than causing failure
to allow conformance to a subset of factor values.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/is_installed.html" class="external-link">is_installed</a></span><span class="op">(</span><span class="st">"ggplot2"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">i_diamonds</span> <span class="op">=</span> <span class="fu"><a href="../reference/iface.html">iface</a></span><span class="op">(</span> </span>
<span>    color <span class="op">=</span> <span class="fu">enum</span><span class="op">(</span><span class="va">D</span>,<span class="va">E</span>,<span class="cn">F</span>,<span class="va">G</span>,<span class="va">H</span>,<span class="va">I</span>,<span class="va">J</span>,<span class="va">extra</span><span class="op">)</span> <span class="op">~</span> <span class="st">"the colour"</span>,</span>
<span>    cut <span class="op">=</span> <span class="fu">enum</span><span class="op">(</span><span class="va">Ideal</span>, <span class="va">Premium</span>, .drop<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">~</span> <span class="st">"the cut"</span>,</span>
<span>    price <span class="op">=</span> <span class="va">integer</span> <span class="op">~</span> <span class="st">"the price"</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="va"><a href="https://ggplot2.tidyverse.org/reference/diamonds.html" class="external-link">diamonds</a></span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="../reference/iconvert.html">iconvert</a></span><span class="op">(</span><span class="va">i_diamonds</span>, .prune <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span>   </span>
<span><span class="op">}</span> </span>
<span><span class="co">#&gt; Rows: 53,940</span></span>
<span><span class="co">#&gt; Columns: 3</span></span>
<span><span class="co">#&gt; $ color <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> E, E, E, I, J, J, I, H, E, H, J, J, F, J, E, E, I, J, J, J, I, E…</span></span>
<span><span class="co">#&gt; $ cut   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> Ideal, Premium, NA, Premium, NA, NA, NA, NA, NA, NA, NA, Ideal, …</span></span>
<span><span class="co">#&gt; $ price <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 326, 326, 327, 334, 335, 336, 336, 337, 337, 338, 339, 340, 342,…</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="more-complex-type-constraints">More complex type constraints<a class="anchor" aria-label="anchor" href="#more-complex-type-constraints"></a>
</h2>
<p>The type of a dataframe column can be defined as a basic data-type,
however more complex constraints are also available provided in
<code>interfacer</code>. These can be listed by searching the help
system with <code>??interfacer::type.</code> at the console.</p>
<table class="table">
<colgroup>
<col width="19%">
<col width="80%">
</colgroup>
<thead><tr class="header">
<th align="left">Topic</th>
<th align="left">Title</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">anything</td>
<td align="left">Coerce to an unspecified type</td>
</tr>
<tr class="even">
<td align="left">character</td>
<td align="left">Coerce to a character.</td>
</tr>
<tr class="odd">
<td align="left">complete</td>
<td align="left">Coerce to a complete set of values.</td>
</tr>
<tr class="even">
<td align="left">date</td>
<td align="left">Coerce to a Date.</td>
</tr>
<tr class="odd">
<td align="left">default</td>
<td align="left">Set a default value for a column</td>
</tr>
<tr class="even">
<td align="left">double</td>
<td align="left">Coerce to a double.</td>
</tr>
<tr class="odd">
<td align="left">enum</td>
<td align="left">Define a conformance rule to match a factor with
specific levels.</td>
</tr>
<tr class="even">
<td align="left">factor</td>
<td align="left">Coerce to a factor.</td>
</tr>
<tr class="odd">
<td align="left">finite</td>
<td align="left">Check for non-finite values</td>
</tr>
<tr class="even">
<td align="left">group_unique</td>
<td align="left">Coerce to a unique value within the current grouping
structure.</td>
</tr>
<tr class="odd">
<td align="left">in_range</td>
<td align="left">Define a conformance rule to confirm that a numeric is
in a set range</td>
</tr>
<tr class="even">
<td align="left">integer</td>
<td align="left">Coerce to integer</td>
</tr>
<tr class="odd">
<td align="left">logical</td>
<td align="left">Coerce to a logical</td>
</tr>
<tr class="even">
<td align="left">not_missing</td>
<td align="left">Check for missing values</td>
</tr>
<tr class="odd">
<td align="left">numeric</td>
<td align="left">Coerce to a numeric.</td>
</tr>
<tr class="even">
<td align="left">of_type</td>
<td align="left">Check for a given class</td>
</tr>
<tr class="odd">
<td align="left">positive_double</td>
<td align="left">Coerce to a positive double.</td>
</tr>
<tr class="even">
<td align="left">positive_integer</td>
<td align="left">Coerce to a positive integer.</td>
</tr>
<tr class="odd">
<td align="left">proportion</td>
<td align="left">Coerce to a number between 0 and 1</td>
</tr>
<tr class="even">
<td align="left">unique_id</td>
<td align="left">A globally unique ids.</td>
</tr>
</tbody>
</table>
<p>The individual help files for these functions explain their use but
in an <code>iface</code> specification they are used on the left hand
side of a formula and can be composed to allow multiple constraints. For
example:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/iface.html">iface</a></span><span class="op">(</span></span>
<span>  col1 <span class="op">=</span> <span class="va">double</span> <span class="op">+</span> <span class="va">finite</span> <span class="op">~</span> <span class="st">"A finite double"</span>,</span>
<span>  col2 <span class="op">=</span> <span class="va">integer</span> <span class="op">+</span> <span class="fu">in_range</span><span class="op">(</span><span class="fl">0</span>,<span class="fl">100</span><span class="op">)</span> <span class="op">~</span> <span class="st">"an integer in the range 0 to 100 inclusive"</span>,</span>
<span>  col3 <span class="op">=</span> <span class="va">numeric</span> <span class="op">+</span> <span class="fu">in_range</span><span class="op">(</span><span class="fl">0</span>,<span class="fl">10</span>, include.max<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">~</span> <span class="st">"a numeric 0 &lt;= x &lt; 10"</span>, </span>
<span>  col4 <span class="op">=</span> <span class="va">date</span> <span class="op">~</span> <span class="st">"A date"</span>,</span>
<span>  col5 <span class="op">=</span> <span class="va">logical</span> <span class="op">+</span> <span class="va">not_missing</span> <span class="op">~</span> <span class="st">"A non-NA logical"</span>,</span>
<span>  col6 <span class="op">=</span> <span class="va">logical</span> <span class="op">+</span> <span class="fu">default</span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">~</span> <span class="st">"A logical with missing (i.e. NA) values coerced to TRUE"</span>,</span>
<span>  col7 <span class="op">=</span> <span class="va">factor</span> <span class="op">~</span> <span class="st">"Any factor"</span>,</span>
<span>  col8 <span class="op">=</span> <span class="fu">enum</span><span class="op">(</span><span class="va">`A`</span>,<span class="va">`B`</span>,<span class="va">`C`</span><span class="op">)</span> <span class="op">+</span> <span class="va">not_missing</span> <span class="op">~</span> <span class="st">"A factor with exactly 3 levels A, B and C and no NA values"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Column wise default values can be supplied with the
<code>default(...)</code> pseudo-function and ranges with
<code>in_range(...)</code>. Their documentation is available in
<code><a href="../reference/type.default.html">?interfacer::type.default</a></code> and
<code><a href="../reference/type.in_range.html">?interfacer::type.in_range</a></code>. It can be noted that although
the internal functions are all prefixed with <code>type.XXX</code>, the
prefix is not needed in the <code>iface</code> specification.</p>
<p>It is also theoretically possible to supply your own checks in this
specification. These must be in the form of a function that accepts one
vector as input and produces one vector as output, or throws an error as
in this example.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">uppercase</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">x</span> <span class="op">!=</span> <span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">toupper</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"not upper case input"</span>,call. <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">custom_eg</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span> <span class="op">=</span> <span class="fu"><a href="../reference/iface.html">iface</a></span><span class="op">(</span></span>
<span>  text <span class="op">=</span> <span class="va">character</span> <span class="op">+</span> <span class="va">uppercase</span> <span class="op">~</span> <span class="st">"An uppercase input only"</span></span>
<span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">df</span> <span class="op">=</span> <span class="fu"><a href="../reference/ivalidate.html">ivalidate</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>text <span class="op">=</span> <span class="st">"SUCCESS"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">custom_eg</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 1</span></span></span>
<span><span class="co">#&gt;   text   </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> SUCCESS</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>text <span class="op">=</span> <span class="st">"fail"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">custom_eg</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error : input column `text` in function parameter `custom_eg(df = ?)` cannot be coerced to a character + uppercase: not upper case input</span></span></code></pre></div>
<p>N.B. When using custom conditions within a package they must be
visible to <code>interfacer</code> this normally means they will need to
be exported and may need to be referred to with package prefix.</p>
<p>A final option is to use an <code>as.XXX</code> function as a
condition. In this example we define a column as a <code>POSIXct</code>
type, and a second column is defined as a <code>ts</code> class
vector:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Coerce the `date_col` to a POSIXct and </span></span>
<span><span class="va">custom_eg_2</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span> <span class="va">df</span> <span class="op">=</span> <span class="fu"><a href="../reference/iface.html">iface</a></span><span class="op">(</span></span>
<span>    date_col <span class="op">=</span> <span class="va">POSIXct</span> <span class="op">~</span> <span class="st">"a posix date"</span>,</span>
<span>    ts_col <span class="op">=</span> <span class="fu">of_type</span><span class="op">(</span><span class="va">ts</span><span class="op">)</span> <span class="op">~</span> <span class="st">"A timeseries vector"</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">df</span> <span class="op">=</span> <span class="fu"><a href="../reference/ivalidate.html">ivalidate</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">class</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  date_col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2001-01-01"</span>,<span class="st">"2002-01-01"</span><span class="op">)</span>,</span>
<span>  ts_col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/ts.html" class="external-link">ts</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">custom_eg_2</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; $date_col</span></span>
<span><span class="co">#&gt; [1] "POSIXct" "POSIXt" </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $ts_col</span></span>
<span><span class="co">#&gt; [1] "ts"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="default-dataframe-values">Default dataframe values<a class="anchor" aria-label="anchor" href="#default-dataframe-values"></a>
</h2>
<p>Because <code>interfacer</code> hijacks the R default value for a
function parameter to define the input dataframe constraints, there
needs to be an alternative way to supply a default value if one is
needed. To do this the <code>iface</code> specification can define a
default. This can either be a) A zero length dataframe, or b) a
dataframe supplied at the time of interface definition, or c) a data
frame supplied at the time of function execution.</p>
<p>To get a zero length dataframe as the default the value of
<code>TRUE</code> is passed to the <code>.default</code> value of
<code>iface</code>:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">i_iris</span> <span class="op">=</span> <span class="fu">interfacer</span><span class="fu">::</span><span class="fu"><a href="../reference/iface.html">iface</a></span><span class="op">(</span></span>
<span>    Sepal.Length <span class="op">=</span> <span class="va">numeric</span> <span class="op">~</span> <span class="st">"the Sepal.Length column"</span>,</span>
<span>    Sepal.Width <span class="op">=</span> <span class="va">numeric</span> <span class="op">~</span> <span class="st">"the Sepal.Width column"</span>,</span>
<span>    Petal.Length <span class="op">=</span> <span class="va">numeric</span> <span class="op">~</span> <span class="st">"the Petal.Length column"</span>,</span>
<span>    Petal.Width <span class="op">=</span> <span class="va">numeric</span> <span class="op">~</span> <span class="st">"the Petal.Width column"</span>,</span>
<span>    Species <span class="op">=</span> <span class="fu">enum</span><span class="op">(</span><span class="va">`setosa`</span>,<span class="va">`versicolor`</span>,<span class="va">`virginica`</span><span class="op">)</span> <span class="op">~</span> <span class="st">"the Species column"</span>,</span>
<span>    .groups <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  .default <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">test_fn</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">i</span> <span class="op">=</span> <span class="va">i_iris</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># if i is not provided (a missing value) the default zero length </span></span>
<span>  <span class="co"># dataframe defined by `i_iris` is used.</span></span>
<span>  <span class="va">i</span> <span class="op">=</span> <span class="fu"><a href="../reference/ivalidate.html">ivalidate</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Outputs a zero length data frame as the default value</span></span>
<span><span class="fu">test_fn</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 0</span></span>
<span><span class="co">#&gt; Columns: 5</span></span>
<span><span class="co">#&gt; $ Sepal.Length <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> </span></span>
<span><span class="co">#&gt; $ Sepal.Width  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> </span></span>
<span><span class="co">#&gt; $ Petal.Length <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> </span></span>
<span><span class="co">#&gt; $ Petal.Width  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> </span></span>
<span><span class="co">#&gt; $ Species      <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span></span></span></code></pre></div>
<p>In this second example the default value is specified during the
interface specification.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">i_iris_2</span> <span class="op">=</span> <span class="fu">interfacer</span><span class="fu">::</span><span class="fu"><a href="../reference/iface.html">iface</a></span><span class="op">(</span></span>
<span>    Sepal.Length <span class="op">=</span> <span class="va">numeric</span> <span class="op">~</span> <span class="st">"the Sepal.Length column"</span>,</span>
<span>    Sepal.Width <span class="op">=</span> <span class="va">numeric</span> <span class="op">~</span> <span class="st">"the Sepal.Width column"</span>,</span>
<span>    Petal.Length <span class="op">=</span> <span class="va">numeric</span> <span class="op">~</span> <span class="st">"the Petal.Length column"</span>,</span>
<span>    Petal.Width <span class="op">=</span> <span class="va">numeric</span> <span class="op">~</span> <span class="st">"the Petal.Width column"</span>,</span>
<span>    Species <span class="op">=</span> <span class="fu">enum</span><span class="op">(</span><span class="va">`setosa`</span>,<span class="va">`versicolor`</span>,<span class="va">`virginica`</span><span class="op">)</span> <span class="op">~</span> <span class="st">"the Species column"</span>,</span>
<span>    .groups <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  .default <span class="op">=</span> <span class="va">iris</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">test_fn_2</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">i</span> <span class="op">=</span> <span class="va">i_iris_2</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">i</span> <span class="op">=</span> <span class="fu"><a href="../reference/ivalidate.html">ivalidate</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Outputs the 150 row iris data frame as a default value from the definition of `i_iris_2`</span></span>
<span><span class="fu">test_fn_2</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 150</span></span>
<span><span class="co">#&gt; Columns: 5</span></span>
<span><span class="co">#&gt; $ Sepal.Length <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 5.1, 4.9, 4.7, 4.6, 5.0, 5.4, 4.6, 5.0, 4.4, 4.9, 5.4, 4.…</span></span>
<span><span class="co">#&gt; $ Sepal.Width  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 3.5, 3.0, 3.2, 3.1, 3.6, 3.9, 3.4, 3.4, 2.9, 3.1, 3.7, 3.…</span></span>
<span><span class="co">#&gt; $ Petal.Length <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1.4, 1.4, 1.3, 1.5, 1.4, 1.7, 1.4, 1.5, 1.4, 1.5, 1.5, 1.…</span></span>
<span><span class="co">#&gt; $ Petal.Width  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.2, 0.2, 0.2, 0.2, 0.2, 0.4, 0.3, 0.2, 0.2, 0.1, 0.2, 0.…</span></span>
<span><span class="co">#&gt; $ Species      <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> setosa, setosa, setosa, setosa, setosa, setosa, setosa, s…</span></span></code></pre></div>
<p>In this third example we override the default on a per function basis
by supplying a default to <code>ivalidate</code> within the function
body. In this case the default is just the first 5 rows:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">test_fn_3</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">i</span> <span class="op">=</span> <span class="va">i_iris_2</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">i</span> <span class="op">=</span> <span class="fu"><a href="../reference/ivalidate.html">ivalidate</a></span><span class="op">(</span><span class="va">i</span>, .default <span class="op">=</span> <span class="va">iris</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Outputs the first 5 rows of the iris data frame as the default value</span></span>
<span><span class="fu">test_fn_3</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 5</span></span>
<span><span class="co">#&gt; Columns: 5</span></span>
<span><span class="co">#&gt; $ Sepal.Length <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 5.1, 4.9, 4.7, 4.6, 5.0</span></span>
<span><span class="co">#&gt; $ Sepal.Width  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 3.5, 3.0, 3.2, 3.1, 3.6</span></span>
<span><span class="co">#&gt; $ Petal.Length <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1.4, 1.4, 1.3, 1.5, 1.4</span></span>
<span><span class="co">#&gt; $ Petal.Width  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.2, 0.2, 0.2, 0.2, 0.2</span></span>
<span><span class="co">#&gt; $ Species      <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> setosa, setosa, setosa, setosa, setosa</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>This vignette covers the primary validation functions of
<code>interfacer</code>, including missing columns, data-type checks and
enforcing grouping structure. Automation of documentation and interface
composition is also covered.</p>
<p>Please see the other vignettes for topics such as function dispatch
based on <code>iface</code> specifications, automatically handling
grouped input, nesting and <code>purrr</code> style list columns, and a
quick summary of tools to help developers.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Robert Challen.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
